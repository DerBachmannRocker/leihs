
- @h.each_pair do |budget_period, requests|

  .panel{class: "panel-#{header_color(budget_period)}"}
    .panel-heading
      .row
        .col-sm-2.h4
          %i.fa.fa-calendar
          = budget_period
          - if @user and not budget_period.past?
            %a{href: choose_user_budget_period_templates_path(@user, budget_period)}
              %i.fa.fa-plus-circle
        .col-sm-6
          = render partial: 'procurement/budget_periods/phases', locals: {budget_period: budget_period}
        .col-sm-4
          - total_price = requests.map {|r| r.total_price(current_user) }.sum
          .label.label-primary.big_total_price
            %i.fa.fa-shopping-cart
            = money_without_cents_and_with_symbol total_price, false

    .panel-body
      - requests.group_by(&:group).each_pair do |group, requests|
        .row{style: 'line-height: 2.5em; background-color: #f5f5f5;'}
          .col-sm-7.h4
            %i.fa.fa-shopping-cart
            = group
            - if @user and not budget_period.past?
              %a{href: group_budget_period_user_requests_path(group, budget_period, @user)}
                %i.fa.fa-plus-circle
            - elsif group.inspectable_by? current_user
              %a{href: choose_group_budget_period_users_path(group, budget_period)}
                %i.fa.fa-plus-circle
          .col-sm-1
            - total_price = requests.map {|r| r.total_price(current_user) }.sum
            - if group.inspectable_by? current_user
              - budget_limit_amount = group.budget_limits.find_by(budget_period_id: budget_period.id).try(:amount)
              = render partial: 'procurement/requests/progress_radial', locals: {used: total_price.to_i, max: budget_limit_amount.to_i}
          .col-sm-4
            - if group.inspectable_by? current_user
              .label.label-default.budget_limit
                %i.fa.fa-pie-chart
                = money_without_cents_and_with_symbol budget_limit_amount, false
              %br
            .label.label-primary.big_total_price
              %i.fa.fa-shopping-cart
              = money_without_cents_and_with_symbol total_price, false

        - requests.each do |request|
          %a.list-group-item.row{href: group_budget_period_user_requests_path(request.group, request.budget_period, request.user), data: {request_id: request.id}}
            .col-sm-2
              = request.article_name
            .col-sm-2
              = request.user
            .col-sm-2
              = request.organization.parent
              %br
              = request.organization
            .col-sm-1
              .label.label-primary.total_price
                %i.fa.fa-tag
                = money_without_cents_and_with_symbol request.price, false
            .col-sm-1.quantities
              :ruby
                state, label_class = state_label(request)
              .label{class: label_class}
                = request.requested_quantity
                %i.fa.fa-question
              %br
              .label{class: label_class}
                - if request.approved_quantity
                  = request.approved_quantity
                  %i.fa.fa-check
                - else
                  &nbsp;
              %br
              .label{class: label_class}
                - if request.order_quantity
                  = request.order_quantity
                  %i.fa.fa-shopping-cart
                - else
                  &nbsp;
            .col-sm-2
              %br
              %br
              .label.label-primary.total_price
                %i.fa.fa-shopping-cart
                = money_without_cents_and_with_symbol request.total_price(current_user), false
            .col-sm-1
              .label.label-default= _(request.priority)
            .col-sm-1
              :ruby
                state, label_class = state_label(request)
              .label{class: label_class}
                = _(state.to_s.humanize)

:scss
  .panel-body {
    padding-top: 0;
    padding-bottom: 0;

    .list-group-item {
      padding-left: 0;
      padding-right: 0;
      min-height: 6em;

      .quantities .label {
        min-width: 4em;
        display: inline-block;
      }
    }
  }
